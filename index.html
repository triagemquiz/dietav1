# Update project to include post-payment diet generation logic (client-side) and zip it

import zipfile, os

base = "/mnt/data/quiz-dieta-pos-pagamento"
os.makedirs(base, exist_ok=True)

html = """
<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Quiz Dieta Personalizada</title>
<style>
:root{
  --primary:#ff6f61;
  --primary-soft:#ffe9e6;
  --bg:#fff8f1;
  --card:#ffffff;
  --border:#e6e6e6;
  --text:#1f2a37;
}
*{box-sizing:border-box;font-family:Inter,Arial,sans-serif}
body{margin:0;background:var(--bg);color:var(--text)}
.header{background:#fff;padding:20px 24px;border-bottom:1px solid #eee}
.header h1{margin:0;font-size:28px}
.progress-wrap{display:flex;gap:16px;margin-top:10px}
.progress{flex:1;height:8px;background:#eee;border-radius:20px;overflow:hidden}
.progress span{display:block;height:100%;background:var(--primary)}
.step{font-size:14px;color:#666}
.container{max-width:920px;margin:32px auto;padding:0 16px}
.card{background:#fff;border-radius:16px;padding:40px;box-shadow:0 10px 30px rgba(0,0,0,.08)}
.question{font-size:26px;font-weight:700}
.underline{width:60px;height:4px;background:linear-gradient(90deg,var(--primary),#9ae6b4);margin:12px 0 24px}
.options{display:grid;grid-template-columns:1fr 1fr;gap:16px}
.option{border:2px solid var(--border);border-radius:12px;padding:18px;cursor:pointer}
.option.active{border-color:var(--primary);background:var(--primary-soft)}
.actions{display:flex;justify-content:space-between;margin-top:32px}
.btn{padding:12px 20px;border-radius:10px;border:1px solid var(--border);cursor:pointer}
.btn.primary{background:var(--primary);color:#fff;border:none}
.summary{background:#f7e6d0;border-radius:12px;padding:16px}
.meal{margin-bottom:16px}
</style>
</head>
<body>

<div class="header">
  <h1>Quiz Dieta Personalizada</h1>
  <div class="progress-wrap">
    <div class="progress"><span id="bar"></span></div>
    <div class="step" id="step"></div>
  </div>
</div>

<div class="container">
  <div class="card" id="app"></div>
</div>

<script>
const paymentLink = "https://www.mercadopago.com.br/checkout/v1/payment/redirect/?source=link&preference-id=458668909-7c027914-15b4-4014-b75a-0a487d24dc5a&router-request-id=bfc8787c-75b8-4218-8b13-30c837638e69";

const questions = [
 {q:"Objetivo",o:["Perder peso","Ganhar massa muscular","Manter peso","Melhorar saúde geral"]},
 {q:"Atividade",o:["Sedentário","Leve","Moderado","Intenso"]},
 {q:"Restrição",o:["Nenhuma","Vegetariano","Vegano","Intolerância/Alergia"]},
 {q:"Refeições",o:["1-2","3","4-5","6+"]},
 {q:"Idade",o:["<20","20-30","30-40","40+"]},
 {q:"Sexo",o:["Masculino","Feminino","Outro"]},
 {q:"Condição",o:["Nenhuma","Diabetes","Hipertensão","Outra"]},
];

let step=0, answers={};

const app=document.getElementById("app");

function render(){
 document.getElementById("bar").style.width=((step+1)/8*100)+"%";
 document.getElementById("step").innerText=(step+1)+"/8";
 const q=questions[step];
 app.innerHTML=`
  <div class="question">${q.q}</div>
  <div class="underline"></div>
  <div class="options">
    ${q.o.map(o=>`<div class="option ${answers[q.q]==o?'active':''}" onclick="sel('${o}')">${o}</div>`).join("")}
  </div>
  <div class="actions">
    <button class="btn" onclick="prev()">Anterior</button>
    <button class="btn primary" onclick="next()">Próxima</button>
  </div>`;
}
function sel(o){answers[questions[step].q]=o;render();}
function next(){ if(!answers[questions[step].q])return; step++; step<questions.length?render():checkout();}
function prev(){if(step>0){step--;render();}}

function checkout(){
 localStorage.setItem("quizAnswers",JSON.stringify(answers));
 window.location.href=paymentLink;
}

function generateDiet(){
 const a=JSON.parse(localStorage.getItem("quizAnswers"));
 let diet=[];
 if(a.Objetivo==="Perder peso") diet.push("Café da manhã: ovos + frutas");
 if(a.Objetivo==="Ganhar massa muscular") diet.push("Café da manhã: ovos + aveia");
 diet.push("Almoço: proteína magra + legumes");
 diet.push("Jantar: refeição leve com vegetais");
 app.innerHTML=`
  <h2>Sua dieta personalizada</h2>
  <div class="summary">
    ${diet.map(m=>`<div class="meal">${m}</div>`).join("")}
  </div>`;
}

if(window.location.search.includes("success")){
 generateDiet();
}else{
 render();
}
</script>
</body>
</html>
"""

with open(os.path.join(base,"index.html"),"w",encoding="utf-8") as f:
    f.write(html)

zip_path="/mnt/data/quiz-dieta-pos-pagamento.zip"
with zipfile.ZipFile(zip_path,"w",zipfile.ZIP_DEFLATED) as z:
    z.write(os.path.join(base,"index.html"),"index.html")

zip_path
